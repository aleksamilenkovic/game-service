<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mozzartbet.gameservice.mapper.MatchEventMapper">
	<!-- public long count(); -->
	<select id="count" resultType="Long">
		select count(*) from events
	</select>

	<resultMap type="MatchEvent" id="MatchEventMap">
			<id column="id" property="id"/>
			<result column="created_on" property="createdOn"/>
			<result column="modified_on" property="modifiedOn"/>
			<result column="match_id" property="matchId"/>
			<result column="score_summary" property="scoreSummary"/>
			<result column="event_time" property="timestamp"/>
			<result column="event_type" property="eventType"/>
			<result column="home_team_action" property="homeTeamAction"/>
			<result column="away_team_action" property="awayTeamAction"/>
			<result column="points_made" property="pointsMade"/>
			<result column="neutral_action" property="neutralAction"/>
			<result column="quarter" property="quarter"/>
			<result column="first_player_id" property="firstPlayerId"/>
			<result column="second_player_id" property="secondPlayerId" />
			
	</resultMap>
	
	<!-- public MatchEvent getById(Long id); -->
	<select id="getById" parameterType="long" resultMap="MatchEventMap">
		select 
			e.*
			from events e
			where e.id=#{id}
	</select>

	<!-- public int save(MatchEvent); -->
	<insert id="save" parameterType="MatchEvent">
		<selectKey keyProperty="id" resultType="long" order="BEFORE">
			select sq_events.nextval from dual
		</selectKey>
		insert into events
			(id,created_on,modified_on,match_id,score_summary,event_time
			,event_type,home_team_action,away_team_action,points_made,neutral_action
			,quarter,first_player_id,second_player_id)
			values(
			#{id},current_timestamp,current_timestamp,#{matchId},#{scoreSummary},#{timestamp},
			#{eventType},#{homeTeamAction},#{awayTeamAction},#{pointsMade},#{neutralAction}
			,#{quarter},#{firstPlayerId},#{secondPlayerId})
	</insert>

	<!-- public int update(MatchEvent event) -->
	<update id="update" parameterType="MatchEvent">
		update events
			set <if test="{matchId}!=null">match_id=#{matchId,jdbcType=VARCHAR}</if>,
				score_summary=#{scoreSummary},
				event_time=#{timestamp},
				points_made=#{pointsMade},
				first_player_id=#{firstPlayerId},
				second_player_id=#{secondPlayerId}
	</update>
	
	<!-- public int deleteById(@Param("id") Long id); -->
	<delete id="deleteById" parameterType="long">
		delete from events where id = #{id}
	</delete>
</mapper>